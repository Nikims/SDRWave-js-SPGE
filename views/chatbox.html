<!doctype html>
<html lang="en" style="height: 100%">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chatbox</title>
    <style>
      body {
        overflow: hidden;
        height: 100%;
        display: flex;
        flex-direction: column;
      }
      #chatbox {
        height: fit-content;
        max-height: 100px;
        overflow-y: scroll;
        border: 1px solid #ccc;
        padding: 10px;
      }
      input {
        width: 100%;
        padding: 6px 12px;
        background: rgb(31, 32, 35);
        border: 1px solid rgb(60, 63, 68);
        border-radius: 4px;
        font-size: 13px;
        color: rgb(247, 248, 248);
        height: 46px;
        appearance: none;
        transition: border 0.15s ease 0s;
        :focus {
          outline: none;
          box-shadow: none;
          border-color: rgb(100, 153, 255);
        }
      }
      #messageinput-cnt {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        max-height: max-content;
        height: 20%;
      }
    </style>
  </head>
  <body>
    <div id="chatbox">
      <!-- Messages will be displayed here -->
    </div>
    <div id="messageinput-cnt">
      <button onclick="sendMessage()" hidden></button>
      <div>
        <input
          autocomplete="off"
          type="text"
          id="messageInput"
          placeholder="Type your message here"
        />
      </div>
    </div>
    <script>
      // Function to load previous messages
      const messageInput = document.getElementById("messageInput");
      messageInput.addEventListener("keypress", function (event) {
        // If the user presses the "Enter" key on the keyboard
        if (event.key === "Enter") {
          // Cancel the default action, if needed
          event.preventDefault();
          // Trigger the button element with a click
          sendMessage();
        }
      });
      function loadMessages() {
        fetch("/chatMessages")
          .then((response) => response.json())
          .then((data) => {
            const chatbox = document.getElementById("chatbox");
            chatbox.innerHTML = ""; // Clear the chatbox before loading new messages
            console.log(data);
            data.chatMessages.forEach((message) => {
              const messageDiv = document.createElement("div");
              messageDiv.textContent = `${message.senderUsername}: ${message.messageContent}`;
              chatbox.appendChild(messageDiv);
            });
          })
          .catch((error) => console.error("Error:", error));
      }

      // Function to send a message
      function sendMessage() {
        const content = messageInput.value;
        fetch("/chatMessage", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ content }),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            loadMessages(); // Reload messages after sending a new message
            messageInput.value = "";
          })

          .catch((error) => console.error("Error:", error));
      }

      // Load previous messages when the page loads
      document.addEventListener("DOMContentLoaded", function () {
        loadMessages();
        setInterval(loadMessages,2000)
      });
    </script>
    <style>
      #chatbox > div {
        font-weight: 500;
        color: white;
      }
    </style>
  </body>
</html>
